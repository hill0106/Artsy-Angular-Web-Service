<app-navbar></app-navbar>
<main>
<!-- REGISTRATION FORM -->
  <div class="container mt-5">
    <h3 class="mb-4">Register</h3>
  
    <!-- Template-driven form -->
    <form #registerForm="ngForm" (ngSubmit)="onSubmit(registerForm)" novalidate>
      <!-- Fullname -->
      <div class="form-group">
        <label for="fullname">Fullname</label>
        <input
          type="text"
          class="form-control"
          [ngClass]="{
            'is-invalid': fullname.invalid && (fullname.dirty || fullname.touched)
          }"
          id="fullname"
          name="fullname"
          required
          [(ngModel)]="formData.name"
          #fullname="ngModel"
          placeholder="John Doe"
        />
        <div class="text-danger" *ngIf="fullname.invalid && (fullname.dirty || fullname.touched)">
          <small *ngIf="fullname.errors?.['required']">Fullname is required.</small>
        </div>
      </div>
  
      <!-- Email -->
      <div class="form-group">
        <label for="email">Email address</label>
        <input
          type="email"
          class="form-control"
          class="form-control"
          [ngClass]="{
            'is-invalid': (email.invalid && (email.dirty || email.touched)) || backendErrors.email
          }"
          id="email"
          name="email"
          required
          pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,20}$"
          [(ngModel)]="formData.email"
          (ngModelChange)="clearEmailError()"
          #email="ngModel"
          placeholder="Enter email"
          (blur)="checkEmail(email.value)"
        />
    <!-- Client-side validation errors -->
      <div class="text-danger" *ngIf="email.invalid && (email.dirty || email.touched)">
        <small *ngIf="email.errors?.['required']">Email is required.</small>
        <small *ngIf="email.errors?.['pattern']">Email must be valid.</small>
      </div>
      <!-- Backend error for "email already exists" -->
      <div class="text-danger" *ngIf="backendErrors.email">
        <small>{{ backendErrors.email }}</small>
      </div>
      </div>
  
      <!-- Password -->
      <div class="form-group">
        <label for="password">Password</label>
        <input
          type="password"
          class="form-control"
          [ngClass]="{
            'is-invalid': password.invalid && (password.dirty || password.touched) || errorMessage
          }"
          id="password"
          name="password"
          required
          [(ngModel)]="formData.password"
          #password="ngModel"
          placeholder="Password"
        />
        <div class="text-danger" *ngIf="password.invalid && (password.dirty || password.touched)">
          <small *ngIf="password.errors?.['required']">Password is required.</small>
        </div>
        <div class="text-danger" *ngIf="errorMessage">
          <small>{{ errorMessage }}</small>
        </div>
      </div>
  
      
      <!-- Submit Button -->
      <button
        type="submit"
        class="btn btn-block register-btn"
        [disabled]="registerForm.invalid || isLoading"
      >
      <span *ngIf="!isLoading">Register</span>
      <span *ngIf="isLoading">
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </span>
      </button>
    </form>

  </div>
    
    <!-- Login Link -->
    <div class="mt-3">
        <span>Already have an account?  <a routerLink="/login" routerLinkActiveOptions="{ exact: true }" class="login">Login</a></span>
    </div>
</main>
<app-footer></app-footer>